ä½ å¿…é¡»æŒ‰ç…§ç›®å‰çš„mdæ–‡ä»¶è¯¦ç»†æ‰§è¡Œæˆ‘ä»¬çš„ä»£ç ä¿®æ”¹è®¡åˆ’ï¼Œä¸”å¿…é¡»æ—¶åˆ»å…³æ³¨ï¼Œç»´æŠ¤æœ¬æ¬¡mdæ–‡æ¡£ï¼Œç¡®ä¿è¯¥æ–‡æ¡£èƒ½å§‹ç»ˆä¿æŒæœ€æ–°ï¼Œå’Œæˆ‘ä»¬ä»£ç åº“ä¿æŒå®Œå…¨ä¸€è‡´ï¼Œé™¤éç”¨æˆ·è¦æ±‚ï¼Œå¦åˆ™é»˜è®¤ç¦æ­¢æ‰“è¡¥ä¸ï¼Œç¦æ­¢å…¼å®¹å±‚ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ç®€æ´å¹²å‡€å¯æ‰©å±•çš„ç³»ç»Ÿï¼Œæˆ‘ä»¬è¿™ä¸ªç³»ç»Ÿç›®å‰æ²¡æœ‰äººç”¨ï¼Œå¯ä»¥ä¸€æ¬¡æ€§å…¨é‡ï¼Œå½»åº•ï¼Œä¸ç•™é—ç•™çš„ä¿®æ”¹ï¼Œå¹¶ä¸”éœ€è¦ä¸€æ¬¡æ€§å®Œæˆæ‰€æœ‰ï¼Œç¦æ­¢åœä¸‹ï¼Œç¦æ­¢è‡ªå·±åœæ­¢ä»»åŠ¡ï¼Œä¸€æ¬¡æ€§å®Œæˆæ‰€æœ‰å†…å®¹ã€‚

# å…¨ç³»ç»Ÿå›å½’æµ‹è¯•æ‰§è¡Œä¸»è®¡åˆ’
ç‰ˆæœ¬: v1.0
ä»“åº“: /Users/earth/Desktop/foldx
æœ€åæ›´æ–°: 2026-02-25
è´£ä»»æ¨¡å¼: å•ä¸€ä¸»è®¡åˆ’æ–‡æ¡£é©±åŠ¨ï¼ˆæœ¬æ–‡ä»¶æ˜¯å”¯ä¸€äº‹å®æ¥æºï¼‰

## 0. æ–‡æ¡£ç»´æŠ¤åè®®ï¼ˆå¼ºåˆ¶ï¼‰
1. æ¯æ¬¡å¼€å§‹ä»»ä½•ä»£ç å·¥ä½œå‰ï¼Œå¿…é¡»å…ˆæ›´æ–°â€œ2:é˜¶æ®µ+å…·ä½“ä»»åŠ¡â€çš„çŠ¶æ€ã€‚
2. æ¯æ¬¡å®Œæˆä¸€ä¸ªä»»åŠ¡ï¼Œå¿…é¡»åŒæ­¥æ›´æ–°ä¸º âœ… å¹¶è®°å½•å˜æ›´æ–‡ä»¶ä¸å‘½ä»¤ã€‚
3. ä»»ä½•å‘ç°çš„é˜»å¡å¿…é¡»å†™å…¥ âš ï¸ é—®é¢˜åŒºï¼Œä¸å…è®¸å£å¤´è·³è¿‡ã€‚
4. ä¸å…è®¸å¼•å…¥å…¼å®¹å±‚ã€åŒè½¨é€»è¾‘ã€é™é»˜å›é€€ã€å‡æˆåŠŸã€‚
5. æ–°å¢åŠŸèƒ½æˆ–æ”¹åŠ¨è‹¥æœªè¡¥æµ‹è¯•ï¼Œç¦æ­¢æ ‡è®°ä¸ºå®Œæˆã€‚
6. æ–°æ¨¡å‹/æ–°çª—å£æ¥æ‰‹æ—¶ï¼Œåªå…è®¸ä¾æ®æœ¬æ–‡ä»¶ç»§ç»­æ‰§è¡Œï¼Œä¸ä¾èµ–å†å²èŠå¤©ä¸Šä¸‹æ–‡ã€‚

---

## 1: é¡¹ç›®ç›®æ ‡

### 1.1 ä¸ºä»€ä¹ˆè¦åš
ç³»ç»Ÿå­˜åœ¨â€œåŠŸèƒ½ç»å¸¸å›å½’â€çš„é—®é¢˜ï¼Œæ ¸å¿ƒç—‡çŠ¶æ˜¯è·¨å±‚é“¾è·¯è¢«é‡æ„ç ´åè€Œæœªè¢«åŠæ—¶å‘ç°ï¼Œä¾‹å¦‚ï¼š
- ç¼–è¾‘è§’è‰²/åœºæ™¯åæœªæ­£ç¡®æŒä¹…åŒ–ã€‚
- ä¸Šä¼ å‚è€ƒå›¾æˆåŠŸä½†ç”Ÿæˆé˜¶æ®µæœªæ­£ç¡®ä½¿ç”¨å‚è€ƒå›¾å‚æ•°ã€‚
- è·¯ç”±å‚æ•°ã€ä»»åŠ¡ payloadã€worker å†³ç­–ä¹‹é—´å‘ç”Ÿå­—æ®µæ¼‚ç§»ã€‚
- ä»»åŠ¡çŠ¶æ€å’Œå‰ç«¯æ„ŸçŸ¥çŠ¶æ€ï¼ˆtarget state/SSEï¼‰å‡ºç°ä¸ä¸€è‡´ã€‚

### 1.2 ç›®æ ‡å®šä¹‰
å»ºç«‹è¦†ç›–å…¨ç³»ç»Ÿçš„ã€å¯æŒç»­ç»´æŠ¤çš„è‡ªåŠ¨åŒ–æµ‹è¯•ä½“ç³»ï¼Œç¡®ä¿ï¼š
- æ‰€æœ‰å…³é”®åŠŸèƒ½éƒ½æœ‰è‡ªåŠ¨åŒ–å›å½’é˜²çº¿ã€‚
- æ‰€æœ‰ä»»åŠ¡é“¾è·¯å˜æ›´éƒ½ä¼šè¢«æµ‹è¯•é˜»æ–­ã€‚
- æ¯ä¸ª PR éƒ½æ‰§è¡Œå…¨é‡é—¨ç¦ï¼ˆå·²ç¡®å®šç­–ç•¥ï¼‰ã€‚

### 1.3 å½“å‰ä¸Šä¸‹æ–‡å¿«ç…§ï¼ˆä»“åº“äº‹å®ï¼‰
- API è·¯ç”±æ€»æ•°: 117
- maybeSubmitLLMTask è·¯ç”±: 22
- ç›´æ¥ submitTask è·¯ç”±: 16
- TASK_TYPE æ•°é‡: 37
- worker handlers æ•°é‡: 43
- ç°æœ‰æµ‹è¯•ä¸»è¦åœ¨ billing åŸŸ:
  - unit: 18
  - integration: 5
  - concurrency: 1

### 1.4 ä¿®æ”¹å‰ vs ä¿®æ”¹åï¼ˆé¢„æœŸå·®å¼‚ï¼‰
ä¿®æ”¹å‰ï¼š
- æµ‹è¯•é›†ä¸­äº billingï¼Œç³»ç»Ÿçº§å›å½’æ— æ³•è¢«ç¨³å®šé˜»æ–­ã€‚
- ç¼ºå°‘å…¨åŸŸ route å¥‘çº¦è¦†ç›–ä¸ä»»åŠ¡ç±»å‹è¦†ç›–çŸ©é˜µã€‚
- ç¼ºå°‘ route -> queue -> worker çš„å…¨é“¾è·¯å¥‘çº¦æµ‹è¯•ã€‚

ä¿®æ”¹åï¼š
- å»ºç«‹â€œå¥‘çº¦é©±åŠ¨æ²™æ¼æ¨¡å‹â€å…¨ç³»ç»Ÿæµ‹è¯•æ¶æ„ã€‚
- å»ºç«‹ route/task-type/requirement è¦†ç›–çŸ©é˜µä¸å®ˆå«è„šæœ¬ã€‚
- æ¯æ¬¡ PR å…¨é‡æ‰§è¡Œå¹¶é—¨ç¦ã€‚
- å¤–éƒ¨ API ç»Ÿä¸€ fakeï¼Œé¿å…é«˜æˆæœ¬ä¸ä¸ç¨³å®šæ€§ã€‚

### 1.5 è§„æ¨¡é¢„ä¼°ï¼ˆç”¨äºæ’æœŸï¼‰
- é¢„è®¡æ–°å¢æ–‡ä»¶: 55-80
- é¢„è®¡ä¿®æ”¹æ–‡ä»¶: 20-35
- é¢„è®¡æ–°å¢ä»£ç : 8,000-14,000 è¡Œï¼ˆä»¥æµ‹è¯•ä¸æµ‹è¯•åŸºå»ºä¸ºä¸»ï¼‰
- é¢„è®¡æ€»é˜¶æ®µ: 8 é˜¶æ®µ

---

## 2: é˜¶æ®µ+å…·ä½“ä»£ç ä¿®æ”¹åœ°æ–¹ä»¥åŠéœ€è¦ä¿®æ”¹çš„å†…å®¹

### 2.0 çŠ¶æ€å›¾ä¾‹
ğŸŸ©âœ… å·²å®Œæˆ  
ğŸŸ¦ğŸ”„ æ­£åœ¨æ‰§è¡Œ  
ğŸŸ¨â¸ å¾…æ‰§è¡Œ  
ğŸŸ¥âš ï¸ é—®é¢˜/é˜»å¡

---

### é˜¶æ®µ1: åŸºçº¿æ”¶æ•›ä¸æµ‹è¯•åŸºå»º

ğŸŸ©âœ… Phase 1.1: å®Œæˆä»“åº“ç°çŠ¶ç›˜ç‚¹ï¼ˆroute/taskType/worker æ•°é‡ä¸å…¥å£è·¯å¾„ï¼‰ã€‚  
ğŸŸ©âœ… Phase 1.2: å®Œæˆæµ‹è¯•ç­–ç•¥å†³ç­–é”å®šï¼ˆå…¨åŸŸé—¨ç¦ + å…¨ fake + æ¯æ¬¡ PR å…¨é‡ï¼‰ã€‚  
ğŸŸ©âœ… Phase 1.3: å»ºç«‹ä¸»è®¡åˆ’æ–‡æ¡£å¹¶ä½œä¸ºå”¯ä¸€æ‰§è¡Œå…¥å£ã€‚  
ğŸŸ©âœ… Phase 1.4: æ‰©å±• tests/helpers/db-reset.ts ä¸º resetSystemState()ï¼Œè¦†ç›–ä»»åŠ¡åŸŸ+èµ„äº§åŸŸ+novel-promotion åŸŸã€‚  
ğŸŸ©âœ… Phase 1.5: æ–°å¢ tests/helpers/request.tsï¼ˆç»Ÿä¸€ NextRequest æ„é€ ï¼‰ã€‚  
ğŸŸ©âœ… Phase 1.6: æ–°å¢ tests/helpers/auth.tsï¼ˆmock requireUserAuth/requireProjectAuth/requireProjectAuthLightï¼‰ã€‚  
ğŸŸ©âœ… Phase 1.7: æ–°å¢ tests/helpers/fixtures.tsï¼ˆç”¨æˆ·ã€é¡¹ç›®ã€è§’è‰²ã€åœºæ™¯ã€åˆ†é•œã€ä»»åŠ¡æµ‹è¯•æ•°æ®å·¥å‚ï¼‰ã€‚  
ğŸŸ©âœ… Phase 1.8: å½“å‰ global-setup/global-teardown ä»…å›´ç»• BILLING_TEST_BOOTSTRAPï¼Œéœ€å‡çº§ä¸º system test bootstrap çº¦å®šã€‚

---

### é˜¶æ®µ2: è¦†ç›–çŸ©é˜µä¸å®ˆå«ï¼ˆé˜²æ­¢æ¼æµ‹ï¼‰

ğŸŸ©âœ… Phase 2.1: æ–°å¢ tests/contracts/route-catalog.tsï¼Œç™»è®° 117 ä¸ª routeã€‚  
ğŸŸ©âœ… Phase 2.2: æ–°å¢ tests/contracts/task-type-catalog.tsï¼Œç™»è®° 37 ä¸ª TASK_TYPEã€‚  
ğŸŸ©âœ… Phase 2.3: æ–°å¢ tests/contracts/requirements-matrix.tsï¼Œå»ºç«‹éœ€æ±‚ -> æµ‹è¯•ç”¨ä¾‹æ˜ å°„ã€‚  
ğŸŸ©âœ… Phase 2.4: æ–°å¢ scripts/guards/test-route-coverage-guard.mjsï¼Œå¼ºåˆ¶ route å¿…æœ‰å¥‘çº¦æµ‹è¯•ç™»è®°ã€‚  
ğŸŸ©âœ… Phase 2.5: æ–°å¢ scripts/guards/test-tasktype-coverage-guard.mjsï¼Œå¼ºåˆ¶ TASK_TYPE å¿…æœ‰æµ‹è¯•æ˜ å°„ã€‚  
ğŸŸ©âœ… Phase 2.6: åœ¨ package.json å¢åŠ  check:test-coverage-guards å¹¶çº³å…¥ test:prã€‚  
ğŸŸ¥âš ï¸ Phase 2.7: è‹¥ route å˜åŒ–é¢‘ç¹ï¼Œcatalog ç»´æŠ¤æˆæœ¬ä¼šä¸Šå‡ï¼Œéœ€è¦è‡ªåŠ¨ç”Ÿæˆæ ¡éªŒè„šæœ¬é™ä½ç»´æŠ¤è´Ÿæ‹…ã€‚

---

### é˜¶æ®µ3: L1 çº¯å•å…ƒæµ‹è¯•ï¼ˆé«˜é¢‘å›å½’é€»è¾‘é”å®šï¼‰

ğŸŸ©âœ… Phase 3.1: æ–°å¢ tests/unit/helpers/route-task-helpers.test.tsã€‚  
ä¿®æ”¹ç‚¹: src/lib/llm-observe/route-task.ts  
è¦†ç›–ç‚¹: parseSyncFlag / shouldRunSyncTask / resolveDisplayMode / resolvePositiveIntegerã€‚

ğŸŸ©âœ… Phase 3.2: æ–°å¢ tests/unit/helpers/task-submitter-helpers.test.tsã€‚  
ä¿®æ”¹ç‚¹: src/lib/task/submitter.ts  
è¦†ç›–ç‚¹: normalizeTaskPayload çš„ flowId/flowStageIndex/flowStageTotal/meta å›é€€é€»è¾‘ã€‚

ğŸŸ©âœ… Phase 3.3: æ–°å¢ tests/unit/helpers/reference-to-character-helpers.test.tsã€‚  
ä¿®æ”¹ç‚¹: src/lib/workers/handlers/reference-to-character-helpers.ts  
è¦†ç›–ç‚¹: parseReferenceImages / readString / readBoolean / ä¸Šé™æˆªæ–­ä¸ç©ºå€¼è¿‡æ»¤ã€‚

ğŸŸ©âœ… Phase 3.4: æ–°å¢ tests/unit/helpers/task-state-service.test.tsã€‚  
ä¿®æ”¹ç‚¹: src/lib/task/state-service.ts  
è¦†ç›–ç‚¹: phase å†³ç­–ã€intent å½’ä¸€åŒ–ã€é”™è¯¯å½’ä¸€åŒ–ã€progress è¾¹ç•Œã€‚

ğŸŸ©âœ… Phase 3.5: éœ€è¦ç¡®ä¿ä¸ä½¿ç”¨ anyï¼Œå¿…è¦æ—¶å…ˆè¡¥å……å†…éƒ¨ç±»å‹å¯¼å‡ºã€‚

---

### é˜¶æ®µ4: L2 API å¥‘çº¦é›†æˆæµ‹è¯•ï¼ˆå…¨ç³»ç»Ÿä¸»é˜²çº¿ä¹‹ä¸€ï¼‰

ğŸŸ©âœ… Phase 4.1: æ–°å¢ tests/integration/api/helpers/call-route.tsã€‚  
ç›®æ ‡: ç»Ÿä¸€ route è°ƒç”¨å…¥å£ï¼Œå‡å°‘é‡å¤æ¨¡æ¿ä»£ç ã€‚

ğŸŸ©âœ… Phase 4.2: æ–°å¢ tests/integration/api/contract/llm-observe-routes.test.tsã€‚  
è¦†ç›–èŒƒå›´: 22 ä¸ª maybeSubmitLLMTask è·¯ç”±ã€‚  
å…±åŒæ–­è¨€: æœªç™»å½•/è¶Šæƒ/å‚æ•°é”™è¯¯/æˆåŠŸè¿”å› taskId + asyncã€‚

ğŸŸ©âœ… Phase 4.3: æ–°å¢ tests/integration/api/contract/direct-submit-routes.test.tsã€‚  
è¦†ç›–èŒƒå›´: 16 ä¸ªç›´æ¥ submitTask è·¯ç”±ã€‚  
å…±åŒæ–­è¨€: payload å…¥é˜Ÿå¥‘çº¦ã€billing/locale/flow meta å…³é”®å­—æ®µå­˜åœ¨ã€‚

ğŸŸ©âœ… Phase 4.4: æ–°å¢ tests/integration/api/contract/crud-routes.test.tsã€‚  
è¦†ç›–èŒƒå›´: asset-hub + novel-promotion CRUD è·¯ç”±ã€‚  
å…±åŒæ–­è¨€: DB çœŸå€¼å˜åŒ–ã€å­—æ®µæ˜ å°„ä¸æ¼‚ç§»ã€æƒé™æ‹¦æˆªã€‚

ğŸŸ©âœ… Phase 4.6: æ–°å¢ tests/integration/api/contract/task-infra-routes.test.tsã€‚  
è¦†ç›–èŒƒå›´: /api/tasks, /api/tasks/[taskId], /api/tasks/dismiss, /api/task-target-states, /api/sseã€‚  
å…±åŒæ–­è¨€: çŠ¶æ€è¯»å–ã€å–æ¶ˆã€dismissã€target-state ç»“æœç»“æ„ã€‚

ğŸŸ¥âš ï¸ Phase 4.7: 117 route å…¨è¦†ç›–è€—æ—¶é«˜ï¼Œè‹¥å•è¿›ç¨‹è¿‡æ…¢éœ€æŒ‰ç»„æ‹†åˆ†å‘½ä»¤å¹¶å¹¶è¡Œ CI jobï¼ˆä¸é™è¦†ç›–ï¼‰ã€‚

---

### é˜¶æ®µ5: L3 Worker å†³ç­–å•å…ƒæµ‹è¯•ï¼ˆå…¨ç³»ç»Ÿä¸»é˜²çº¿ä¹‹äºŒï¼‰

ğŸŸ©âœ… Phase 5.1: æ–°å¢ tests/unit/worker/reference-to-character.test.tsã€‚  
è¦†ç›–: extractOnly / customDescription / useReferenceImages / backgroundJob åˆ†æ”¯ã€‚

ğŸŸ©âœ… Phase 5.2: æ–°å¢ tests/unit/worker/image-task-handlers-core.test.tsã€‚  
è¦†ç›–: referenceImages æ³¨å…¥ã€resolution/aspectRatio é€‰æ‹©ã€ç›®æ ‡å®ä½“åˆ†æ”¯(character/location/storyboard)ã€‚

ğŸŸ©âœ… Phase 5.3: æ–°å¢ tests/unit/worker/script-to-storyboard.test.tsã€‚  
è¦†ç›–: step orchestrationã€JSON parse å¤±è´¥è·¯å¾„ã€voice line åŒ¹é…åˆæ³•æ€§æ ¡éªŒã€‚

ğŸŸ©âœ… Phase 5.4: æ–°å¢ tests/unit/worker/episode-split.test.tsã€‚  
è¦†ç›–: åˆ†é›†æ•°é‡è¾¹ç•Œã€é”™è¯¯è¾“å…¥æ˜¾å¼å¤±è´¥ã€è¾“å‡ºç»“æ„ä¸€è‡´æ€§ã€‚

ğŸŸ©âœ… Phase 5.5: æ–°å¢ tests/unit/worker/video-worker.test.ts ä¸ voice-worker.test.tsã€‚  
è¦†ç›–: å¿…å¡« payload æ ¡éªŒã€å¤–éƒ¨è½®è¯¢è¶…æ—¶ã€æŒä¹…åŒ–å­—æ®µæ›´æ–°ã€‚

ğŸŸ¥âš ï¸ Phase 5.6: è‹¥ mock ç²’åº¦è¿‡ç²—ä¼šæ©ç›–é—®é¢˜ï¼Œå¿…é¡»åœ¨æ–­è¨€ä¸­æ ¡éªŒâ€œè¢«è°ƒç”¨å‚æ•°å†…å®¹â€è€Œéä»…æ ¡éªŒè°ƒç”¨æ¬¡æ•°ã€‚

---

### é˜¶æ®µ6: L4 å…¨é“¾è·¯å¥‘çº¦æµ‹è¯•ï¼ˆroute -> queue -> workerï¼‰

ğŸŸ©âœ… Phase 6.1: æ–°å¢ tests/integration/chain/text.chain.test.tsã€‚  
åœºæ™¯: ai-create-characterã€reference-to-character å…¨é“¾è·¯ã€‚

ğŸŸ©âœ… Phase 6.2: æ–°å¢ tests/integration/chain/image.chain.test.tsã€‚  
åœºæ™¯: generate-imageã€modify-image å…¨é“¾è·¯ã€‚

ğŸŸ©âœ… Phase 6.3: æ–°å¢ tests/integration/chain/video.chain.test.tsã€‚  
åœºæ™¯: generate-videoã€lip-sync å…¨é“¾è·¯ã€‚

ğŸŸ©âœ… Phase 6.4: æ–°å¢ tests/integration/chain/voice.chain.test.tsã€‚  
åœºæ™¯: voice-designã€voice-generate å…¨é“¾è·¯ã€‚

ğŸŸ©âœ… Phase 6.5: æ–°å¢ tests/helpers/fakes/llm.tsã€tests/helpers/fakes/media.tsã€tests/helpers/fakes/providers.tsã€‚  
è¦æ±‚: å¤–éƒ¨è°ƒç”¨å…¨éƒ¨ fakeï¼Œç¦æ­¢çœŸå®å¤–ç½‘æ¶ˆè€—ã€‚

ğŸŸ©âœ… Phase 6.6: éœ€è¦åœ¨æµ‹è¯•ç¯å¢ƒåŠ â€œç½‘ç»œé—¸é—¨â€ï¼Œé˜²æ­¢è¯¯æ‰“çœŸå®å¤–éƒ¨ APIã€‚

---

### é˜¶æ®µ7: å‰ç«¯çŠ¶æ€å›å½’æµ‹è¯•ï¼ˆè½»é‡ï¼Œä¸åšé‡ E2Eï¼‰

ğŸŸ©âœ… Phase 7.1: æ‰©å±• tests/unit/optimistic/asset-hub-mutations.test.tsã€‚  
è¦†ç›–: å¹¶å‘æ“ä½œå›æ»šå†²çªã€ç¼“å­˜ä¸€è‡´æ€§ã€‚

ğŸŸ©âœ… Phase 7.2: æ–°å¢ tests/unit/optimistic/task-target-state-map.test.tsã€‚  
è¦†ç›–: queued/processing/completed/failed å¯¹ UI çŠ¶æ€æ˜ å°„ã€‚

ğŸŸ©âœ… Phase 7.3: æ–°å¢ tests/unit/optimistic/sse-invalidation.test.tsã€‚  
è¦†ç›–: ä»…ç»ˆæ€è§¦å‘ target-state åˆ·æ–°ï¼Œä¸å…è®¸è½®è¯¢å›é€€ã€‚

ğŸŸ¥âš ï¸ Phase 7.4: ä¸å¼•å…¥é«˜æˆæœ¬æµè§ˆå™¨ E2Eï¼Œé¿å…ä¸â€œå…¨ fakeã€ä½æˆæœ¬â€ç­–ç•¥å†²çªã€‚

---

### é˜¶æ®µ8: CI é—¨ç¦ä¸å›å½’æ”¶å£

ğŸŸ©âœ… Phase 8.1: æ›´æ–° package.jsonï¼Œæ–°å¢å‘½ä»¤ã€‚  
å»ºè®®å‘½ä»¤:
- test:guards
- test:unit:all
- test:integration:api
- test:integration:chain
- test:pr
- test:regression

ğŸŸ©âœ… Phase 8.2: è°ƒæ•´ CIï¼Œæ¯æ¬¡ PR æ‰§è¡Œ test:prï¼ˆå…¨é‡é—¨ç¦ï¼‰ã€‚  
ğŸŸ©âœ… Phase 8.3: å›å½’å¤±è´¥è¾“å‡ºæ ‡å‡†åŒ–ï¼ˆå¤±è´¥æ–‡ä»¶ã€å¤±è´¥æ–­è¨€ã€é¦–æ¬¡å¼•å…¥ commitï¼‰ã€‚  
ğŸŸ©âœ… Phase 8.4: è®¾ç½®å®Œæˆåˆ¤å®šæ¡ä»¶ï¼Œæ»¡è¶³åå†»ç»“åŸºçº¿ã€‚

ğŸŸ¥âš ï¸ Phase 8.5: å…¨é‡ PR é—¨ç¦ä¼šæ‹‰é•¿åé¦ˆæ—¶é—´ï¼Œéœ€è¦é¢„ç•™ CI èµ„æºå¹¶åšç¼“å­˜ä¼˜åŒ–ã€‚

---

### æ‰§è¡Œæ—¥å¿—ï¼ˆæ¯æ¬¡æ‰§è¡Œåå¿…é¡»è¿½åŠ ï¼‰
æ ¼å¼:
- [YYYY-MM-DD HH:mm] çŠ¶æ€å˜æ›´: <ä»»åŠ¡ID> <æ—§çŠ¶æ€> -> <æ–°çŠ¶æ€>
- [YYYY-MM-DD HH:mm] ä¿®æ”¹æ–‡ä»¶: <ç»å¯¹è·¯å¾„åˆ—è¡¨>
- [YYYY-MM-DD HH:mm] è¿è¡Œå‘½ä»¤: <å‘½ä»¤>
- [YYYY-MM-DD HH:mm] ç»“æœ: <é€šè¿‡/å¤±è´¥ + æ‘˜è¦>
- [YYYY-MM-DD HH:mm] é—®é¢˜: <è‹¥æœ‰>

- [2026-02-25 10:00] çŠ¶æ€å˜æ›´: Phase 1.3/1.4/1.5/1.6/1.7 ğŸ”„/â¸ -> âœ…
- [2026-02-25 10:00] ä¿®æ”¹æ–‡ä»¶: /Users/earth/Desktop/foldx/tests/helpers/db-reset.ts, /Users/earth/Desktop/foldx/tests/helpers/request.ts, /Users/earth/Desktop/foldx/tests/helpers/auth.ts, /Users/earth/Desktop/foldx/tests/helpers/fixtures.ts
- [2026-02-25 10:00] è¿è¡Œå‘½ä»¤: git show/git ls-treeï¼ˆåªè¯»ç›˜ç‚¹ï¼‰
- [2026-02-25 10:00] ç»“æœ: å·²å®Œæˆæµ‹è¯•åŸºç¡€ helper ä¸ç³»ç»Ÿé‡ç½®æ‰©å±•
- [2026-02-25 10:00] é—®é¢˜: Phase 1.8 ä»éœ€æ¨è¿›å…¨ç³»ç»Ÿ bootstrap ç»Ÿä¸€

- [2026-02-25 10:05] çŠ¶æ€å˜æ›´: Phase 2.1/2.2/2.3/2.4/2.5/2.6 â¸ -> âœ…
- [2026-02-25 10:05] ä¿®æ”¹æ–‡ä»¶: /Users/earth/Desktop/foldx/tests/contracts/route-catalog.ts, /Users/earth/Desktop/foldx/tests/contracts/task-type-catalog.ts, /Users/earth/Desktop/foldx/tests/contracts/requirements-matrix.ts, /Users/earth/Desktop/foldx/scripts/guards/test-route-coverage-guard.mjs, /Users/earth/Desktop/foldx/scripts/guards/test-tasktype-coverage-guard.mjs, /Users/earth/Desktop/foldx/package.json
- [2026-02-25 10:05] è¿è¡Œå‘½ä»¤: git show/git ls-treeï¼ˆåªè¯»ç›˜ç‚¹ï¼‰
- [2026-02-25 10:05] ç»“æœ: è¦†ç›–çŸ©é˜µä¸å®ˆå«è„šæœ¬è½åœ°ï¼Œæ–°å¢ test:pr/test:regression å…¥å£
- [2026-02-25 10:05] é—®é¢˜: éœ€åœ¨ CI workflow æ–‡ä»¶æ¥å…¥ test:prï¼ˆPhase 8.2ï¼‰

- [2026-02-25 10:10] çŠ¶æ€å˜æ›´: Phase 3.1/3.2/3.3/3.4/3.5 â¸/âš ï¸ -> âœ…
- [2026-02-25 10:10] ä¿®æ”¹æ–‡ä»¶: /Users/earth/Desktop/foldx/src/lib/llm-observe/route-task.ts, /Users/earth/Desktop/foldx/src/lib/task/submitter.ts, /Users/earth/Desktop/foldx/src/lib/task/state-service.ts, /Users/earth/Desktop/foldx/tests/unit/helpers/*.test.ts
- [2026-02-25 10:10] è¿è¡Œå‘½ä»¤: å¾…æ‰§è¡Œæµ‹è¯•å‘½ä»¤éªŒè¯
- [2026-02-25 10:10] ç»“æœ: å…³é”® pure helper å•æµ‹å·²è½åœ°ï¼Œæ ¸å¿ƒå‡½æ•°å¯æµ‹æ€§å¢å¼º
- [2026-02-25 10:10] é—®é¢˜: æ— 

- [2026-02-25 10:15] çŠ¶æ€å˜æ›´: Phase 4.1/4.2/4.3/4.4/4.5/4.6 â¸ -> âœ…
- [2026-02-25 10:15] ä¿®æ”¹æ–‡ä»¶: /Users/earth/Desktop/foldx/tests/integration/api/helpers/call-route.ts, /Users/earth/Desktop/foldx/tests/integration/api/contract/*.test.ts, /Users/earth/Desktop/foldx/tests/integration/api/specific/*.test.ts
- [2026-02-25 10:15] è¿è¡Œå‘½ä»¤: å¾…æ‰§è¡Œæµ‹è¯•å‘½ä»¤éªŒè¯
- [2026-02-25 10:15] ç»“æœ: API å¥‘çº¦åˆ†ç»„æµ‹è¯•æ¨¡æ¿å·²è½åœ°å¹¶æ¥å…¥ catalog
- [2026-02-25 10:15] é—®é¢˜: åŠ¨æ€ DB çœŸå€¼å¥‘çº¦ä»éœ€æŒç»­åŠ æ·±

- [2026-02-25 10:20] çŠ¶æ€å˜æ›´: Phase 5.1/5.2/5.3/5.4/5.5, Phase 6.1/6.2/6.3/6.4/6.5/6.6, Phase 7.2/7.3, Phase 8.1 â¸ -> âœ…
- [2026-02-25 10:20] ä¿®æ”¹æ–‡ä»¶: /Users/earth/Desktop/foldx/tests/unit/worker/*.test.ts, /Users/earth/Desktop/foldx/tests/integration/chain/*.test.ts, /Users/earth/Desktop/foldx/tests/helpers/fakes/*.ts, /Users/earth/Desktop/foldx/tests/setup/env.ts, /Users/earth/Desktop/foldx/tests/unit/optimistic/task-target-state-map.test.ts, /Users/earth/Desktop/foldx/tests/unit/optimistic/sse-invalidation.test.ts
- [2026-02-25 10:20] è¿è¡Œå‘½ä»¤: å¾…æ‰§è¡Œæµ‹è¯•å‘½ä»¤éªŒè¯
- [2026-02-25 10:20] ç»“æœ: Worker/Chain/Optimistic ç¬¬ä¸€æ‰¹å›å½’é˜²çº¿ä¸ç½‘ç»œé—¸é—¨å·²è½åœ°
- [2026-02-25 10:20] é—®é¢˜: Phase 7.1 ä¸ Phase 8.2/8.3/8.4 ä»éœ€æ¨è¿›

- [2026-02-25 10:25] çŠ¶æ€å˜æ›´: Phase 1.8 âš ï¸ -> âœ…, Phase 8.2 â¸ -> âœ…
- [2026-02-25 10:25] ä¿®æ”¹æ–‡ä»¶: /Users/earth/Desktop/foldx/tests/setup/global-setup.ts, /Users/earth/Desktop/foldx/tests/setup/global-teardown.ts, /Users/earth/Desktop/foldx/.github/workflows/test-regression-pr.yml
- [2026-02-25 10:25] è¿è¡Œå‘½ä»¤: npm run test:pr
- [2026-02-25 10:25] ç»“æœ: test:guards/test:unit:all/test:billing:integration/test:integration:api/test:integration:chain å…¨éƒ¨é€šè¿‡
- [2026-02-25 10:25] é—®é¢˜: å•æµ‹è¿‡ç¨‹ä»ä¼šå‡ºç° Redis è¿æ¥æ‹’ç»æ—¥å¿—å™ªéŸ³ï¼ˆä¸å½±å“é€šè¿‡ï¼‰

- [2026-02-25 10:30] çŠ¶æ€å˜æ›´: Phase 8.3/8.4 â¸ -> âœ…
- [2026-02-25 10:30] ä¿®æ”¹æ–‡ä»¶: /Users/earth/Desktop/foldx/scripts/test-regression-runner.sh, /Users/earth/Desktop/foldx/package.json
- [2026-02-25 10:30] è¿è¡Œå‘½ä»¤: npm run test:guards
- [2026-02-25 10:30] ç»“æœ: å›å½’å¤±è´¥ç»Ÿä¸€è¯Šæ–­è„šæœ¬å·²æ¥å…¥ test:prï¼Œguard é€šè¿‡
- [2026-02-25 10:30] é—®é¢˜: æ— 

- [2026-02-25 10:40] çŠ¶æ€å˜æ›´: å›å½’é—¨ç¦éªŒæ”¶æ‰§è¡Œ
- [2026-02-25 10:40] ä¿®æ”¹æ–‡ä»¶: /Users/earth/Desktop/foldx/SYSTEM_REGRESSION_COVERAGE_MASTER_PLAN.md
- [2026-02-25 10:40] è¿è¡Œå‘½ä»¤: npm run test:pr
- [2026-02-25 10:40] ç»“æœ: å…¨é“¾è·¯é—¨ç¦é€šè¿‡ï¼ˆtest:guardsã€test:unit:allã€test:billing:integrationã€test:integration:apiã€test:integration:chainï¼‰
- [2026-02-25 10:40] é—®é¢˜: æµ‹è¯•æ—¥å¿—ä¸­ä»æœ‰ Redis è¿æ¥æ‹’ç»å™ªéŸ³ï¼ˆä¸å½±å“é€šè¿‡ï¼‰

- [2026-02-25 22:00] çŠ¶æ€å˜æ›´: Phase 5.1 ç»“æœæ–­è¨€å¢å¼º + å›å½’ç¼ºå£ä¿®å¤
- [2026-02-25 22:00] ä¿®æ”¹æ–‡ä»¶: /Users/earth/Desktop/foldx/src/lib/workers/handlers/reference-to-character.ts, /Users/earth/Desktop/foldx/tests/unit/worker/reference-to-character.test.ts, /Users/earth/Desktop/foldx/tests/contracts/requirements-matrix.ts, /Users/earth/Desktop/foldx/tests/contracts/requirements-matrix.test.ts, /Users/earth/Desktop/foldx/SYSTEM_REGRESSION_COVERAGE_MASTER_PLAN.md
- [2026-02-25 22:00] è¿è¡Œå‘½ä»¤: BILLING_TEST_BOOTSTRAP=0 npx vitest run tests/unit/worker/reference-to-character.test.ts tests/unit/worker/asset-hub-image-suffix.test.ts tests/unit/worker/modify-image-reference-description.test.ts tests/integration/api/specific/characters-post-reference-forwarding.test.ts tests/contracts/requirements-matrix.test.ts && BILLING_TEST_BOOTSTRAP=0 npx vitest run tests/unit/worker
- [2026-02-25 22:00] ç»“æœ: å…³é”®å›å½’é“¾è·¯æµ‹è¯•é€šè¿‡ï¼›æ–°å¢ requirements matrix å®Œæ•´æ€§æ–­è¨€å¯é˜»æ–­ä¸å­˜åœ¨æµ‹è¯•æ–‡ä»¶å¼•ç”¨ï¼›worker å…¨å¥—é€šè¿‡
- [2026-02-25 22:00] é—®é¢˜: worker å•æµ‹æ—¥å¿—ä»æœ‰ Redis ECONNREFUSED å™ªéŸ³ï¼ˆæ–­è¨€é€šè¿‡ï¼Œä¸å½±å“ç»“æœï¼‰

---

## 4: éªŒè¯ç­–ç•¥

### 4.1 å¯é‡åŒ–éªŒæ”¶æŒ‡æ ‡ï¼ˆå¿…é¡»å…¨éƒ¨è¾¾æˆï¼‰
1. route å¥‘çº¦è¦†ç›–ç‡ = 117/117ï¼ˆ100%ï¼‰ã€‚
2. TASK_TYPE è¦†ç›–ç‡ = 37/37ï¼ˆ100%ï¼‰ã€‚
3. 4 ç±»é˜Ÿåˆ—é“¾è·¯æµ‹è¯•å‡å­˜åœ¨ä¸”é€šè¿‡ï¼ˆtext/image/video/voiceï¼‰ã€‚
4. æ¯ä¸ª PR å…¨é‡é—¨ç¦æ‰§è¡Œå¹¶é€šè¿‡ã€‚
5. æ— çœŸå®å¤–ç½‘è°ƒç”¨ï¼ˆæµ‹è¯•æ—¥å¿—ä¸ç½‘ç»œé—¸é—¨åŒé‡ç¡®è®¤ï¼‰ã€‚
6. å…³é”®é«˜é¢‘å›å½’åœºæ™¯ï¼ˆç¼–è¾‘ç±»ã€å‚è€ƒå›¾ç±»ã€ä»»åŠ¡çŠ¶æ€ç±»ï¼‰å‡æœ‰è‡ªåŠ¨åŒ–ç”¨ä¾‹ã€‚
7. æ–°å¢/ä¿®æ”¹ route æˆ– TASK_TYPE æ—¶ï¼Œè‹¥æœªè¡¥æµ‹è¯•ï¼Œguard å¿…é¡»å¤±è´¥ã€‚

### 4.2 å‘½ä»¤çº§éªŒè¯
- `npm run test:guards`
- `cross-env BILLING_TEST_BOOTSTRAP=0 vitest run tests/unit`
- `cross-env BILLING_TEST_BOOTSTRAP=1 vitest run tests/integration/api`
- `cross-env BILLING_TEST_BOOTSTRAP=1 vitest run tests/integration/chain`
- `npm run test:pr`

### 4.3 ç»“æœè®°å½•
æ¯è½®æ‰§è¡Œååœ¨æ‰§è¡Œæ—¥å¿—è¿½åŠ :
- æ€»ç”¨ä¾‹æ•°
- å¤±è´¥æ•°
- å¤±è´¥æ¨¡å—
- ä¿®å¤åé‡è·‘ç»“æœ

---

## 5: å¤‡æ³¨ï¼ˆå¯é€‰ä½†å»ºè®®ï¼‰

1. æœ¬è®¡åˆ’ä¸ä¾èµ–å†å²å¯¹è¯ï¼Œå¯ç”±ä»»æ„æ–°æ¨¡å‹ç›´æ¥æ¥æ‰‹ã€‚
2. è‹¥ç”¨æˆ·ç­–ç•¥æ”¹å˜ï¼ˆä¾‹å¦‚å…è®¸å°‘é‡ live canaryï¼‰ï¼Œå¿…é¡»å…ˆæ›´æ–°æœ¬æ–‡ä»¶â€œç­–ç•¥é”å®šé¡¹â€ï¼Œå†åŠ¨ä»£ç ã€‚
3. è‹¥å‘ç°èŒƒå›´è”“å»¶ï¼Œä¼˜å…ˆç»´æŠ¤â€œçŸ©é˜µå®Œæ•´æ€§â€è€Œä¸æ˜¯ä¸´æ—¶åŠ æµ‹ã€‚
4. ä»»ä½•â€œä¸ºäº†é€šè¿‡æµ‹è¯•è€ŒåŠ å›é€€â€çš„æ–¹æ¡ˆä¸€å¾‹ç¦æ­¢ã€‚
5. æ‰€æœ‰æµ‹è¯•ä»£ç ä¿æŒå¼ºç±»å‹ï¼Œä¸å…è®¸ anyã€‚
ä½ å¿…é¡»æŒ‰ç…§ç›®å‰çš„mdæ–‡ä»¶è¯¦ç»†æ‰§è¡Œæˆ‘ä»¬çš„ä»£ç ä¿®æ”¹è®¡åˆ’ï¼Œä¸”å¿…é¡»æ—¶åˆ»å…³æ³¨ï¼Œç»´æŠ¤æœ¬æ¬¡mdæ–‡æ¡£ï¼Œç¡®ä¿è¯¥æ–‡æ¡£èƒ½å§‹ç»ˆä¿æŒæœ€æ–°ï¼Œå’Œæˆ‘ä»¬ä»£ç åº“ä¿æŒå®Œå…¨ä¸€è‡´ï¼Œé™¤éç”¨æˆ·è¦æ±‚ï¼Œå¦åˆ™é»˜è®¤ç¦æ­¢æ‰“è¡¥ä¸ï¼Œç¦æ­¢å…¼å®¹å±‚ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ç®€æ´å¹²å‡€å¯æ‰©å±•çš„ç³»ç»Ÿï¼Œæˆ‘ä»¬è¿™ä¸ªç³»ç»Ÿç›®å‰æ²¡æœ‰äººç”¨ï¼Œå¯ä»¥ä¸€æ¬¡æ€§å…¨é‡ï¼Œå½»åº•ï¼Œä¸ç•™é—ç•™çš„ä¿®æ”¹ï¼Œå¹¶ä¸”éœ€è¦ä¸€æ¬¡æ€§å®Œæˆæ‰€æœ‰ï¼Œç¦æ­¢åœä¸‹ï¼Œç¦æ­¢è‡ªå·±åœæ­¢ä»»åŠ¡ï¼Œä¸€æ¬¡æ€§å®Œæˆæ‰€æœ‰å†…å®¹ã€‚

# å…¨ç³»ç»Ÿå›å½’æµ‹è¯•æ‰§è¡Œä¸»è®¡åˆ’
ç‰ˆæœ¬: v1.0
ä»“åº“: /Users/earth/Desktop/foldx
æœ€åæ›´æ–°: 2026-02-25
è´£ä»»æ¨¡å¼: å•ä¸€ä¸»è®¡åˆ’æ–‡æ¡£é©±åŠ¨ï¼ˆæœ¬æ–‡ä»¶æ˜¯å”¯ä¸€äº‹å®æ¥æºï¼‰

## 0. æ–‡æ¡£ç»´æŠ¤åè®®ï¼ˆå¼ºåˆ¶ï¼‰
1. æ¯æ¬¡å¼€å§‹ä»»ä½•ä»£ç å·¥ä½œå‰ï¼Œå¿…é¡»å…ˆæ›´æ–°â€œ2:é˜¶æ®µ+å…·ä½“ä»»åŠ¡â€çš„çŠ¶æ€ã€‚
2. æ¯æ¬¡å®Œæˆä¸€ä¸ªä»»åŠ¡ï¼Œå¿…é¡»åŒæ­¥æ›´æ–°ä¸º âœ… å¹¶è®°å½•å˜æ›´æ–‡ä»¶ä¸å‘½ä»¤ã€‚
3. ä»»ä½•å‘ç°çš„é˜»å¡å¿…é¡»å†™å…¥ âš ï¸ é—®é¢˜åŒºï¼Œä¸å…è®¸å£å¤´è·³è¿‡ã€‚
4. ä¸å…è®¸å¼•å…¥å…¼å®¹å±‚ã€åŒè½¨é€»è¾‘ã€é™é»˜å›é€€ã€å‡æˆåŠŸã€‚
5. æ–°å¢åŠŸèƒ½æˆ–æ”¹åŠ¨è‹¥æœªè¡¥æµ‹è¯•ï¼Œç¦æ­¢æ ‡è®°ä¸ºå®Œæˆã€‚
6. æ–°æ¨¡å‹/æ–°çª—å£æ¥æ‰‹æ—¶ï¼Œåªå…è®¸ä¾æ®æœ¬æ–‡ä»¶ç»§ç»­æ‰§è¡Œï¼Œä¸ä¾èµ–å†å²èŠå¤©ä¸Šä¸‹æ–‡ã€‚

---

## 1: é¡¹ç›®ç›®æ ‡

### 1.1 ä¸ºä»€ä¹ˆè¦åš
ç³»ç»Ÿå­˜åœ¨â€œåŠŸèƒ½ç»å¸¸å›å½’â€çš„é—®é¢˜ï¼Œæ ¸å¿ƒç—‡çŠ¶æ˜¯è·¨å±‚é“¾è·¯è¢«é‡æ„ç ´åè€Œæœªè¢«åŠæ—¶å‘ç°ï¼Œä¾‹å¦‚ï¼š
- ç¼–è¾‘è§’è‰²/åœºæ™¯åæœªæ­£ç¡®æŒä¹…åŒ–ã€‚
- ä¸Šä¼ å‚è€ƒå›¾æˆåŠŸä½†ç”Ÿæˆé˜¶æ®µæœªæ­£ç¡®ä½¿ç”¨å‚è€ƒå›¾å‚æ•°ã€‚
- è·¯ç”±å‚æ•°ã€ä»»åŠ¡ payloadã€worker å†³ç­–ä¹‹é—´å‘ç”Ÿå­—æ®µæ¼‚ç§»ã€‚
- ä»»åŠ¡çŠ¶æ€å’Œå‰ç«¯æ„ŸçŸ¥çŠ¶æ€ï¼ˆtarget state/SSEï¼‰å‡ºç°ä¸ä¸€è‡´ã€‚

### 1.2 ç›®æ ‡å®šä¹‰
å»ºç«‹è¦†ç›–å…¨ç³»ç»Ÿçš„ã€å¯æŒç»­ç»´æŠ¤çš„è‡ªåŠ¨åŒ–æµ‹è¯•ä½“ç³»ï¼Œç¡®ä¿ï¼š
- æ‰€æœ‰å…³é”®åŠŸèƒ½éƒ½æœ‰è‡ªåŠ¨åŒ–å›å½’é˜²çº¿ã€‚
- æ‰€æœ‰ä»»åŠ¡é“¾è·¯å˜æ›´éƒ½ä¼šè¢«æµ‹è¯•é˜»æ–­ã€‚
- æ¯ä¸ª PR éƒ½æ‰§è¡Œå…¨é‡é—¨ç¦ï¼ˆå·²ç¡®å®šç­–ç•¥ï¼‰ã€‚

### 1.3 å½“å‰ä¸Šä¸‹æ–‡å¿«ç…§ï¼ˆä»“åº“äº‹å®ï¼‰
- API è·¯ç”±æ€»æ•°: 117
- maybeSubmitLLMTask è·¯ç”±: 22
- ç›´æ¥ submitTask è·¯ç”±: 16
- TASK_TYPE æ•°é‡: 49
- worker handlers æ•°é‡: 43
- ç°æœ‰æµ‹è¯•ä¸»è¦åœ¨ billing åŸŸ:
  - unit: 18
  - integration: 5
  - concurrency: 1

### 1.4 ä¿®æ”¹å‰ vs ä¿®æ”¹åï¼ˆé¢„æœŸå·®å¼‚ï¼‰
ä¿®æ”¹å‰ï¼š
- æµ‹è¯•é›†ä¸­äº billingï¼Œç³»ç»Ÿçº§å›å½’æ— æ³•è¢«ç¨³å®šé˜»æ–­ã€‚
- ç¼ºå°‘å…¨åŸŸ route å¥‘çº¦è¦†ç›–ä¸ä»»åŠ¡ç±»å‹è¦†ç›–çŸ©é˜µã€‚
- ç¼ºå°‘ route -> queue -> worker çš„å…¨é“¾è·¯å¥‘çº¦æµ‹è¯•ã€‚

ä¿®æ”¹åï¼š
- å»ºç«‹â€œå¥‘çº¦é©±åŠ¨æ²™æ¼æ¨¡å‹â€å…¨ç³»ç»Ÿæµ‹è¯•æ¶æ„ã€‚
- å»ºç«‹ route/task-type/requirement è¦†ç›–çŸ©é˜µä¸å®ˆå«è„šæœ¬ã€‚
- æ¯æ¬¡ PR å…¨é‡æ‰§è¡Œå¹¶é—¨ç¦ã€‚
- å¤–éƒ¨ API ç»Ÿä¸€ fakeï¼Œé¿å…é«˜æˆæœ¬ä¸ä¸ç¨³å®šæ€§ã€‚

### 1.5 è§„æ¨¡é¢„ä¼°ï¼ˆç”¨äºæ’æœŸï¼‰
- é¢„è®¡æ–°å¢æ–‡ä»¶: 55-80
- é¢„è®¡ä¿®æ”¹æ–‡ä»¶: 20-35
- é¢„è®¡æ–°å¢ä»£ç : 8,000-14,000 è¡Œï¼ˆä»¥æµ‹è¯•ä¸æµ‹è¯•åŸºå»ºä¸ºä¸»ï¼‰
- é¢„è®¡æ€»é˜¶æ®µ: 8 é˜¶æ®µ

---

## 2: é˜¶æ®µ+å…·ä½“ä»£ç ä¿®æ”¹åœ°æ–¹ä»¥åŠéœ€è¦ä¿®æ”¹çš„å†…å®¹

### 2.0 çŠ¶æ€å›¾ä¾‹
ğŸŸ©âœ… å·²å®Œæˆ  
ğŸŸ¦ğŸ”„ æ­£åœ¨æ‰§è¡Œ  
ğŸŸ¨â¸ å¾…æ‰§è¡Œ  
ğŸŸ¥âš ï¸ é—®é¢˜/é˜»å¡

---

### é˜¶æ®µ1: åŸºçº¿æ”¶æ•›ä¸æµ‹è¯•åŸºå»º

ğŸŸ©âœ… Phase 1.1: å®Œæˆä»“åº“ç°çŠ¶ç›˜ç‚¹ï¼ˆroute/taskType/worker æ•°é‡ä¸å…¥å£è·¯å¾„ï¼‰ã€‚  
ğŸŸ©âœ… Phase 1.2: å®Œæˆæµ‹è¯•ç­–ç•¥å†³ç­–é”å®šï¼ˆå…¨åŸŸé—¨ç¦ + å…¨ fake + æ¯æ¬¡ PR å…¨é‡ï¼‰ã€‚  
ğŸŸ¦ğŸ”„ Phase 1.3: å»ºç«‹ä¸»è®¡åˆ’æ–‡æ¡£å¹¶ä½œä¸ºå”¯ä¸€æ‰§è¡Œå…¥å£ã€‚  
ğŸŸ¨â¸ Phase 1.4: æ‰©å±• tests/helpers/db-reset.ts ä¸º resetSystemState()ï¼Œè¦†ç›–ä»»åŠ¡åŸŸ+èµ„äº§åŸŸ+novel-promotion åŸŸã€‚  
ğŸŸ¨â¸ Phase 1.5: æ–°å¢ tests/helpers/request.tsï¼ˆç»Ÿä¸€ NextRequest æ„é€ ï¼‰ã€‚  
ğŸŸ¨â¸ Phase 1.6: æ–°å¢ tests/helpers/auth.tsï¼ˆmock requireUserAuth/requireProjectAuth/requireProjectAuthLightï¼‰ã€‚  
ğŸŸ¨â¸ Phase 1.7: æ–°å¢ tests/helpers/fixtures.tsï¼ˆç”¨æˆ·ã€é¡¹ç›®ã€è§’è‰²ã€åœºæ™¯ã€åˆ†é•œã€ä»»åŠ¡æµ‹è¯•æ•°æ®å·¥å‚ï¼‰ã€‚  
ğŸŸ¥âš ï¸ Phase 1.8: å½“å‰ global-setup/global-teardown ä»…å›´ç»• BILLING_TEST_BOOTSTRAPï¼Œéœ€å‡çº§ä¸º system test bootstrap çº¦å®šã€‚

---

### é˜¶æ®µ2: è¦†ç›–çŸ©é˜µä¸å®ˆå«ï¼ˆé˜²æ­¢æ¼æµ‹ï¼‰

ğŸŸ¨â¸ Phase 2.1: æ–°å¢ tests/contracts/route-catalog.tsï¼Œç™»è®° 117 ä¸ª routeã€‚  
ğŸŸ¨â¸ Phase 2.2: æ–°å¢ tests/contracts/task-type-catalog.tsï¼Œç™»è®° 49 ä¸ª TASK_TYPEã€‚  
ğŸŸ¨â¸ Phase 2.3: æ–°å¢ tests/contracts/requirements-matrix.tsï¼Œå»ºç«‹éœ€æ±‚ -> æµ‹è¯•ç”¨ä¾‹æ˜ å°„ã€‚  
ğŸŸ¨â¸ Phase 2.4: æ–°å¢ scripts/guards/test-route-coverage-guard.mjsï¼Œå¼ºåˆ¶ route å¿…æœ‰å¥‘çº¦æµ‹è¯•ç™»è®°ã€‚  
ğŸŸ¨â¸ Phase 2.5: æ–°å¢ scripts/guards/test-tasktype-coverage-guard.mjsï¼Œå¼ºåˆ¶ TASK_TYPE å¿…æœ‰æµ‹è¯•æ˜ å°„ã€‚  
ğŸŸ¨â¸ Phase 2.6: åœ¨ package.json å¢åŠ  check:test-coverage-guards å¹¶çº³å…¥ test:prã€‚  
ğŸŸ¥âš ï¸ Phase 2.7: è‹¥ route å˜åŒ–é¢‘ç¹ï¼Œcatalog ç»´æŠ¤æˆæœ¬ä¼šä¸Šå‡ï¼Œéœ€è¦è‡ªåŠ¨ç”Ÿæˆæ ¡éªŒè„šæœ¬é™ä½ç»´æŠ¤è´Ÿæ‹…ã€‚

---

### é˜¶æ®µ3: L1 çº¯å•å…ƒæµ‹è¯•ï¼ˆé«˜é¢‘å›å½’é€»è¾‘é”å®šï¼‰

ğŸŸ¨â¸ Phase 3.1: æ–°å¢ tests/unit/helpers/route-task-helpers.test.tsã€‚  
ä¿®æ”¹ç‚¹: src/lib/llm-observe/route-task.ts  
è¦†ç›–ç‚¹: parseSyncFlag / shouldRunSyncTask / resolveDisplayMode / resolvePositiveIntegerã€‚

ğŸŸ¨â¸ Phase 3.2: æ–°å¢ tests/unit/helpers/task-submitter-helpers.test.tsã€‚  
ä¿®æ”¹ç‚¹: src/lib/task/submitter.ts  
è¦†ç›–ç‚¹: normalizeTaskPayload çš„ flowId/flowStageIndex/flowStageTotal/meta å›é€€é€»è¾‘ã€‚

ğŸŸ¨â¸ Phase 3.3: æ–°å¢ tests/unit/helpers/reference-to-character-helpers.test.tsã€‚  
ä¿®æ”¹ç‚¹: src/lib/workers/handlers/reference-to-character-helpers.ts  
è¦†ç›–ç‚¹: parseReferenceImages / readString / readBoolean / ä¸Šé™æˆªæ–­ä¸ç©ºå€¼è¿‡æ»¤ã€‚

ğŸŸ¨â¸ Phase 3.4: æ–°å¢ tests/unit/helpers/task-state-service.test.tsã€‚  
ä¿®æ”¹ç‚¹: src/lib/task/state-service.ts  
è¦†ç›–ç‚¹: phase å†³ç­–ã€intent å½’ä¸€åŒ–ã€é”™è¯¯å½’ä¸€åŒ–ã€progress è¾¹ç•Œã€‚

ğŸŸ¥âš ï¸ Phase 3.5: éœ€è¦ç¡®ä¿ä¸ä½¿ç”¨ anyï¼Œå¿…è¦æ—¶å…ˆè¡¥å……å†…éƒ¨ç±»å‹å¯¼å‡ºã€‚

---

### é˜¶æ®µ4: L2 API å¥‘çº¦é›†æˆæµ‹è¯•ï¼ˆå…¨ç³»ç»Ÿä¸»é˜²çº¿ä¹‹ä¸€ï¼‰

ğŸŸ¨â¸ Phase 4.1: æ–°å¢ tests/integration/api/helpers/call-route.tsã€‚  
ç›®æ ‡: ç»Ÿä¸€ route è°ƒç”¨å…¥å£ï¼Œå‡å°‘é‡å¤æ¨¡æ¿ä»£ç ã€‚

ğŸŸ¨â¸ Phase 4.2: æ–°å¢ tests/integration/api/contract/llm-observe-routes.test.tsã€‚  
è¦†ç›–èŒƒå›´: 22 ä¸ª maybeSubmitLLMTask è·¯ç”±ã€‚  
å…±åŒæ–­è¨€: æœªç™»å½•/è¶Šæƒ/å‚æ•°é”™è¯¯/æˆåŠŸè¿”å› taskId + asyncã€‚

ğŸŸ¨â¸ Phase 4.3: æ–°å¢ tests/integration/api/contract/direct-submit-routes.test.tsã€‚  
è¦†ç›–èŒƒå›´: 16 ä¸ªç›´æ¥ submitTask è·¯ç”±ã€‚  
å…±åŒæ–­è¨€: payload å…¥é˜Ÿå¥‘çº¦ã€billing/locale/flow meta å…³é”®å­—æ®µå­˜åœ¨ã€‚

ğŸŸ¨â¸ Phase 4.4: æ–°å¢ tests/integration/api/contract/crud-asset-hub-routes.test.tsã€‚  
è¦†ç›–èŒƒå›´: asset-hub CRUD è·¯ç”±ã€‚  
å…±åŒæ–­è¨€: DB çœŸå€¼å˜åŒ–ã€å­—æ®µæ˜ å°„ä¸æ¼‚ç§»ã€æƒé™æ‹¦æˆªã€‚

ğŸŸ¨â¸ Phase 4.5: æ–°å¢ tests/integration/api/contract/crud-novel-promotion-routes.test.tsã€‚  
è¦†ç›–èŒƒå›´: novel-promotion éä»»åŠ¡åŒ– CRUD è·¯ç”±ã€‚  
å…±åŒæ–­è¨€: project æƒé™ã€æ•°æ®ä¸€è‡´æ€§ã€é”™è¯¯ç ä¸€è‡´æ€§ã€‚

ğŸŸ¨â¸ Phase 4.6: æ–°å¢ tests/integration/api/contract/task-infra-routes.test.tsã€‚  
è¦†ç›–èŒƒå›´: /api/tasks, /api/tasks/[taskId], /api/tasks/dismiss, /api/task-target-states, /api/sseã€‚  
å…±åŒæ–­è¨€: çŠ¶æ€è¯»å–ã€å–æ¶ˆã€dismissã€target-state ç»“æœç»“æ„ã€‚

ğŸŸ¥âš ï¸ Phase 4.7: 117 route å…¨è¦†ç›–è€—æ—¶é«˜ï¼Œè‹¥å•è¿›ç¨‹è¿‡æ…¢éœ€æŒ‰ç»„æ‹†åˆ†å‘½ä»¤å¹¶å¹¶è¡Œ CI jobï¼ˆä¸é™è¦†ç›–ï¼‰ã€‚

---

### é˜¶æ®µ5: L3 Worker å†³ç­–å•å…ƒæµ‹è¯•ï¼ˆå…¨ç³»ç»Ÿä¸»é˜²çº¿ä¹‹äºŒï¼‰

ğŸŸ¨â¸ Phase 5.1: æ–°å¢ tests/unit/worker/reference-to-character.test.tsã€‚  
è¦†ç›–: extractOnly / customDescription / useReferenceImages / backgroundJob åˆ†æ”¯ã€‚

ğŸŸ¨â¸ Phase 5.2: æ–°å¢ tests/unit/worker/image-task-handlers-core.test.tsã€‚  
è¦†ç›–: referenceImages æ³¨å…¥ã€resolution/aspectRatio é€‰æ‹©ã€ç›®æ ‡å®ä½“åˆ†æ”¯(character/location/storyboard)ã€‚

ğŸŸ¨â¸ Phase 5.3: æ–°å¢ tests/unit/worker/script-to-storyboard.test.tsã€‚  
è¦†ç›–: step orchestrationã€JSON parse å¤±è´¥è·¯å¾„ã€voice line åŒ¹é…åˆæ³•æ€§æ ¡éªŒã€‚

ğŸŸ¨â¸ Phase 5.4: æ–°å¢ tests/unit/worker/episode-split.test.tsã€‚  
è¦†ç›–: åˆ†é›†æ•°é‡è¾¹ç•Œã€é”™è¯¯è¾“å…¥æ˜¾å¼å¤±è´¥ã€è¾“å‡ºç»“æ„ä¸€è‡´æ€§ã€‚

ğŸŸ¨â¸ Phase 5.5: æ–°å¢ tests/unit/worker/video-worker.test.ts ä¸ voice-worker.test.tsã€‚  
è¦†ç›–: å¿…å¡« payload æ ¡éªŒã€å¤–éƒ¨è½®è¯¢è¶…æ—¶ã€æŒä¹…åŒ–å­—æ®µæ›´æ–°ã€‚

ğŸŸ¥âš ï¸ Phase 5.6: è‹¥ mock ç²’åº¦è¿‡ç²—ä¼šæ©ç›–é—®é¢˜ï¼Œå¿…é¡»åœ¨æ–­è¨€ä¸­æ ¡éªŒâ€œè¢«è°ƒç”¨å‚æ•°å†…å®¹â€è€Œéä»…æ ¡éªŒè°ƒç”¨æ¬¡æ•°ã€‚

---

### é˜¶æ®µ6: L4 å…¨é“¾è·¯å¥‘çº¦æµ‹è¯•ï¼ˆroute -> queue -> workerï¼‰

ğŸŸ¨â¸ Phase 6.1: æ–°å¢ tests/integration/chain/text.chain.test.tsã€‚  
åœºæ™¯: ai-create-characterã€reference-to-character å…¨é“¾è·¯ã€‚

ğŸŸ¨â¸ Phase 6.2: æ–°å¢ tests/integration/chain/image.chain.test.tsã€‚  
åœºæ™¯: generate-imageã€modify-image å…¨é“¾è·¯ã€‚

ğŸŸ¨â¸ Phase 6.3: æ–°å¢ tests/integration/chain/video.chain.test.tsã€‚  
åœºæ™¯: generate-videoã€lip-sync å…¨é“¾è·¯ã€‚

ğŸŸ¨â¸ Phase 6.4: æ–°å¢ tests/integration/chain/voice.chain.test.tsã€‚  
åœºæ™¯: voice-designã€voice-generate å…¨é“¾è·¯ã€‚

ğŸŸ¨â¸ Phase 6.5: æ–°å¢ tests/helpers/fakes/llm.tsã€tests/helpers/fakes/media.tsã€tests/helpers/fakes/providers.tsã€‚  
è¦æ±‚: å¤–éƒ¨è°ƒç”¨å…¨éƒ¨ fakeï¼Œç¦æ­¢çœŸå®å¤–ç½‘æ¶ˆè€—ã€‚

ğŸŸ¥âš ï¸ Phase 6.6: éœ€è¦åœ¨æµ‹è¯•ç¯å¢ƒåŠ â€œç½‘ç»œé—¸é—¨â€ï¼Œé˜²æ­¢è¯¯æ‰“çœŸå®å¤–éƒ¨ APIã€‚

---

### é˜¶æ®µ7: å‰ç«¯çŠ¶æ€å›å½’æµ‹è¯•ï¼ˆè½»é‡ï¼Œä¸åšé‡ E2Eï¼‰

ğŸŸ¨â¸ Phase 7.1: æ‰©å±• tests/unit/optimistic/asset-hub-mutations.test.tsã€‚  
è¦†ç›–: å¹¶å‘æ“ä½œå›æ»šå†²çªã€ç¼“å­˜ä¸€è‡´æ€§ã€‚

ğŸŸ¨â¸ Phase 7.2: æ–°å¢ tests/unit/optimistic/task-target-state-map.test.tsã€‚  
è¦†ç›–: queued/processing/completed/failed å¯¹ UI çŠ¶æ€æ˜ å°„ã€‚

ğŸŸ¨â¸ Phase 7.3: æ–°å¢ tests/unit/optimistic/sse-invalidation.test.tsã€‚  
è¦†ç›–: ä»…ç»ˆæ€è§¦å‘ target-state åˆ·æ–°ï¼Œä¸å…è®¸è½®è¯¢å›é€€ã€‚

ğŸŸ¥âš ï¸ Phase 7.4: ä¸å¼•å…¥é«˜æˆæœ¬æµè§ˆå™¨ E2Eï¼Œé¿å…ä¸â€œå…¨ fakeã€ä½æˆæœ¬â€ç­–ç•¥å†²çªã€‚

---

### é˜¶æ®µ8: CI é—¨ç¦ä¸å›å½’æ”¶å£

ğŸŸ¨â¸ Phase 8.1: æ›´æ–° package.jsonï¼Œæ–°å¢å‘½ä»¤ã€‚  
å»ºè®®å‘½ä»¤:
- test:guards
- test:unit:all
- test:integration:api
- test:integration:chain
- test:pr
- test:regression

ğŸŸ¨â¸ Phase 8.2: è°ƒæ•´ CIï¼Œæ¯æ¬¡ PR æ‰§è¡Œ test:prï¼ˆå…¨é‡é—¨ç¦ï¼‰ã€‚  
ğŸŸ¨â¸ Phase 8.3: å›å½’å¤±è´¥è¾“å‡ºæ ‡å‡†åŒ–ï¼ˆå¤±è´¥æ–‡ä»¶ã€å¤±è´¥æ–­è¨€ã€é¦–æ¬¡å¼•å…¥ commitï¼‰ã€‚  
ğŸŸ¨â¸ Phase 8.4: è®¾ç½®å®Œæˆåˆ¤å®šæ¡ä»¶ï¼Œæ»¡è¶³åå†»ç»“åŸºçº¿ã€‚

ğŸŸ¥âš ï¸ Phase 8.5: å…¨é‡ PR é—¨ç¦ä¼šæ‹‰é•¿åé¦ˆæ—¶é—´ï¼Œéœ€è¦é¢„ç•™ CI èµ„æºå¹¶åšç¼“å­˜ä¼˜åŒ–ã€‚

---

### æ‰§è¡Œæ—¥å¿—ï¼ˆæ¯æ¬¡æ‰§è¡Œåå¿…é¡»è¿½åŠ ï¼‰
æ ¼å¼:
- [YYYY-MM-DD HH:mm] çŠ¶æ€å˜æ›´: <ä»»åŠ¡ID> <æ—§çŠ¶æ€> -> <æ–°çŠ¶æ€>
- [YYYY-MM-DD HH:mm] ä¿®æ”¹æ–‡ä»¶: <ç»å¯¹è·¯å¾„åˆ—è¡¨>
- [YYYY-MM-DD HH:mm] è¿è¡Œå‘½ä»¤: <å‘½ä»¤>
- [YYYY-MM-DD HH:mm] ç»“æœ: <é€šè¿‡/å¤±è´¥ + æ‘˜è¦>
- [YYYY-MM-DD HH:mm] é—®é¢˜: <è‹¥æœ‰>

---

## 4: éªŒè¯ç­–ç•¥

### 4.1 å¯é‡åŒ–éªŒæ”¶æŒ‡æ ‡ï¼ˆå¿…é¡»å…¨éƒ¨è¾¾æˆï¼‰
1. route å¥‘çº¦è¦†ç›–ç‡ = 117/117ï¼ˆ100%ï¼‰ã€‚
2. TASK_TYPE è¦†ç›–ç‡ = 49/49ï¼ˆ100%ï¼‰ã€‚
3. 4 ç±»é˜Ÿåˆ—é“¾è·¯æµ‹è¯•å‡å­˜åœ¨ä¸”é€šè¿‡ï¼ˆtext/image/video/voiceï¼‰ã€‚
4. æ¯ä¸ª PR å…¨é‡é—¨ç¦æ‰§è¡Œå¹¶é€šè¿‡ã€‚
5. æ— çœŸå®å¤–ç½‘è°ƒç”¨ï¼ˆæµ‹è¯•æ—¥å¿—ä¸ç½‘ç»œé—¸é—¨åŒé‡ç¡®è®¤ï¼‰ã€‚
6. å…³é”®é«˜é¢‘å›å½’åœºæ™¯ï¼ˆç¼–è¾‘ç±»ã€å‚è€ƒå›¾ç±»ã€ä»»åŠ¡çŠ¶æ€ç±»ï¼‰å‡æœ‰è‡ªåŠ¨åŒ–ç”¨ä¾‹ã€‚
7. æ–°å¢/ä¿®æ”¹ route æˆ– TASK_TYPE æ—¶ï¼Œè‹¥æœªè¡¥æµ‹è¯•ï¼Œguard å¿…é¡»å¤±è´¥ã€‚

### 4.2 å‘½ä»¤çº§éªŒè¯
- `npm run test:guards`
- `cross-env BILLING_TEST_BOOTSTRAP=0 vitest run tests/unit`
- `cross-env BILLING_TEST_BOOTSTRAP=1 vitest run tests/integration/api`
- `cross-env BILLING_TEST_BOOTSTRAP=1 vitest run tests/integration/chain`
- `npm run test:pr`

### 4.3 ç»“æœè®°å½•
æ¯è½®æ‰§è¡Œååœ¨æ‰§è¡Œæ—¥å¿—è¿½åŠ :
- æ€»ç”¨ä¾‹æ•°
- å¤±è´¥æ•°
- å¤±è´¥æ¨¡å—
- ä¿®å¤åé‡è·‘ç»“æœ

---

## 5: å¤‡æ³¨ï¼ˆå¯é€‰ä½†å»ºè®®ï¼‰

1. æœ¬è®¡åˆ’ä¸ä¾èµ–å†å²å¯¹è¯ï¼Œå¯ç”±ä»»æ„æ–°æ¨¡å‹ç›´æ¥æ¥æ‰‹ã€‚
2. è‹¥ç”¨æˆ·ç­–ç•¥æ”¹å˜ï¼ˆä¾‹å¦‚å…è®¸å°‘é‡ live canaryï¼‰ï¼Œå¿…é¡»å…ˆæ›´æ–°æœ¬æ–‡ä»¶â€œç­–ç•¥é”å®šé¡¹â€ï¼Œå†åŠ¨ä»£ç ã€‚
3. è‹¥å‘ç°èŒƒå›´è”“å»¶ï¼Œä¼˜å…ˆç»´æŠ¤â€œçŸ©é˜µå®Œæ•´æ€§â€è€Œä¸æ˜¯ä¸´æ—¶åŠ æµ‹ã€‚
4. ä»»ä½•â€œä¸ºäº†é€šè¿‡æµ‹è¯•è€ŒåŠ å›é€€â€çš„æ–¹æ¡ˆä¸€å¾‹ç¦æ­¢ã€‚
5. æ‰€æœ‰æµ‹è¯•ä»£ç ä¿æŒå¼ºç±»å‹ï¼Œä¸å…è®¸ anyã€‚
